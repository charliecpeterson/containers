Bootstrap: docker
From: centos:7

%help
This is a base CentOS 7 setup
GCC 10.3.0 
Intel OneAPI 
- BaseKit 2021.4.0.3422
- HPCKit 2021.4.0.3347
- AIKit 2021.4.0.1460

%labels
Author Charles Peterson <charles.c.peterson3@gmail.com>


%post
yum -y update \
&& yum -y upgrade \
&& yum install -y  pkgconfig bzip2-devel libffi-devel openssl openssl-devel zlib-devel gmp-devel mpfr-devel libmpc-devel gfortran gcc gcc-c++ libstdc++i=devel flex make ssh patch curl subversion wget unzip perl git file gnupg2 software-properties-common 
yum groupinstall -y "Development Tools"

# Install Cmake 3.22.0
cd /tmp  
wget https://github.com/Kitware/CMake/releases/download/v3.22.0-rc1/cmake-3.22.0-rc1.tar.gz
tar -vxf cmake-3.22.0-rc1.tar.gz
cd cmake-3.22.0-rc1
./bootstrap
make ; make install
cd /tmp
rm -rf cmake-3.22.0-rc1*

#Install GCC 10.3.0
wget https://ftp.gnu.org/gnu/gcc/gcc-10.3.0/gcc-10.3.0.tar.gz
tar -vxf gcc-10.3.0.tar.gz
cd gcc-10.3.0
./configure --enable-bootstrap --enable-shared --enable-threads=posix  --enable-languages=c,c++,fortran --disable-multilib
make ; make install
cd /tmp
rm -rf gcc-10.3.0.tar.gz
rm -rf gcc-10.3.0

# Install Intel OneAPI
wget https://registrationcenter-download.intel.com/akdlm/irc_nas/18236/l_BaseKit_p_2021.4.0.3422.sh
bash l_BaseKit_p_2021.4.0.3422.sh -a --silent --eula accept
rm l_BaseKit_p_2021.4.0.3422.sh
wget https://registrationcenter-download.intel.com/akdlm/irc_nas/18211/l_HPCKit_p_2021.4.0.3347.sh
bash l_HPCKit_p_2021.4.0.3347.sh -a --silent --eula accept
rm l_HPCKit_p_2021.4.0.3347.sh
wget https://registrationcenter-download.intel.com/akdlm/irc_nas/18235/l_AIKit_p_2021.4.0.1460.sh
bash l_AIKit_p_2021.4.0.1460.sh -a --silent --eula accept
rm l_AIKit_p_2021.4.0.1460.sh

%environment
MKLROOT=/opt/intel/oneapi/mkl/2021.4.0
CPLUS_INCLUDE_PATH=/opt/intel/oneapi/clck/2021.4.0/include
MANPATH=/opt/intel/oneapi/mpi/2021.4.0/man:/opt/intel/oneapi/itac/2021.4.0/man:/opt/intel/oneapi/debugger/10.2.4/documentation/man:/opt/intel/oneapi/compiler/2021.4.0/documentation/en/man/common:/opt/intel/oneapi/clck/2021.4.0/man::
VT_MPI=impi4
IPPROOT=/opt/intel/oneapi/ipp/2021.4.0
INTEL_LICENSE_FILE=/opt/intel/licenses:/root/intel/licenses:/opt/intel/oneapi/clck/2021.4.0/licensing:/opt/intel/licenses:/root/intel/licenses:/Users/Shared/Library/Application Support/Intel/Licenses
CLCK_ROOT=/opt/intel/oneapi/clck/2021.4.0
LIBRARY_PATH=/opt/intel/oneapi/vpl/2021.6.0/lib:/opt/intel/oneapi/tbb/2021.4.0/env/../lib/intel64/gcc4.8:/opt/intel/oneapi/mpi/2021.4.0//libfabric/lib:/opt/intel/oneapi/mpi/2021.4.0//lib/release:/opt/intel/oneapi/mpi/2021.4.0//lib:/opt/intel/oneapi/mkl/2021.4.0/lib/intel64:/opt/intel/oneapi/ipp/2021.4.0/lib/intel64:/opt/intel/oneapi/ippcp/2021.4.0/lib/intel64:/opt/intel/oneapi/ipp/2021.4.0/lib/intel64:/opt/intel/oneapi/dnnl/2021.4.0/cpu_dpcpp_gpu_dpcpp/lib:/opt/intel/oneapi/dal/2021.4.0/lib/intel64:/opt/intel/oneapi/compiler/2021.4.0/linux/compiler/lib/intel64_lin:/opt/intel/oneapi/compiler/2021.4.0/linux/lib:/opt/intel/oneapi/clck/2021.4.0/lib/intel64:/opt/intel/oneapi/ccl/2021.4.0/lib/cpu_gpu_dpcpp
CONDA_PROMPT_MODIFIER=(intelpython-python3.7)
OCL_ICD_FILENAMES=libintelocl_emu.so:libalteracl.so:/opt/intel/oneapi/compiler/2021.4.0/linux/lib/x64/libintelocl.so
CCL_CONFIGURATION=cpu_gpu_dpcpp
IPPCRYPTOROOT=/opt/intel/oneapi/ippcp/2021.4.0
LD_LIBRARY_PATH=/opt/intel/oneapi/vpl/2021.6.0/lib:/opt/intel/oneapi/tbb/2021.4.0/env/../lib/intel64/gcc4.8:/opt/intel/oneapi/mpi/2021.4.0//libfabric/lib:/opt/intel/oneapi/mpi/2021.4.0//lib/release:/opt/intel/oneapi/mpi/2021.4.0//lib:/opt/intel/oneapi/mkl/2021.4.0/lib/intel64:/opt/intel/oneapi/itac/2021.4.0/slib:/opt/intel/oneapi/ipp/2021.4.0/lib/intel64:/opt/intel/oneapi/ippcp/2021.4.0/lib/intel64:/opt/intel/oneapi/ipp/2021.4.0/lib/intel64:/opt/intel/oneapi/dnnl/2021.4.0/cpu_dpcpp_gpu_dpcpp/lib:/opt/intel/oneapi/debugger/10.2.4/gdb/intel64/lib:/opt/intel/oneapi/debugger/10.2.4/libipt/intel64/lib:/opt/intel/oneapi/debugger/10.2.4/dep/lib:/opt/intel/oneapi/dal/2021.4.0/lib/intel64:/opt/intel/oneapi/compiler/2021.4.0/linux/lib:/opt/intel/oneapi/compiler/2021.4.0/linux/lib/x64:/opt/intel/oneapi/compiler/2021.4.0/linux/lib/emu:/opt/intel/oneapi/compiler/2021.4.0/linux/lib/oclfpga/host/linux64/lib:/opt/intel/oneapi/compiler/2021.4.0/linux/lib/oclfpga/linux64/lib:/opt/intel/oneapi/compiler/2021.4.0/linux/compiler/lib/intel64_lin:/opt/intel/oneapi/ccl/2021.4.0/lib/cpu_gpu_dpcpp:/.singularity.d/libs
DALROOT=/opt/intel/oneapi/dal/2021.4.0
FPGA_VARS_DIR=/opt/intel/oneapi/compiler/2021.4.0/linux/lib/oclfpga
CONDA_EXE=/opt/intel/oneapi/intelpython/latest/bin/conda
FI_PROVIDER_PATH=/opt/intel/oneapi/mpi/2021.4.0//libfabric/lib/prov:/usr/lib64/libfabric
CMPLR_ROOT=/opt/intel/oneapi/compiler/2021.4.0
CPATH=/opt/intel/oneapi/vpl/2021.6.0/include:/opt/intel/oneapi/tbb/2021.4.0/env/../include:/opt/intel/oneapi/mpi/2021.4.0//include:/opt/intel/oneapi/mkl/2021.4.0/include:/opt/intel/oneapi/ipp/2021.4.0/include:/opt/intel/oneapi/ippcp/2021.4.0/include:/opt/intel/oneapi/ipp/2021.4.0/include:/opt/intel/oneapi/dpl/2021.5.0/linux/include:/opt/intel/oneapi/dpcpp-ct/2021.4.0/include:/opt/intel/oneapi/dnnl/2021.4.0/cpu_dpcpp_gpu_dpcpp/lib:/opt/intel/oneapi/dev-utilities/2021.4.0/include:/opt/intel/oneapi/dal/2021.4.0/include:/opt/intel/oneapi/compiler/2021.4.0/linux/include:/opt/intel/oneapi/ccl/2021.4.0/include/cpu_gpu_dpcpp
DPL_ROOT=/opt/intel/oneapi/dpl/2021.5.0
INTELFPGAOCLSDKROOT=/opt/intel/oneapi/compiler/2021.4.0/linux/lib/oclfpga
MODEL_ZOO_VERSION=2021.4.0
IPPCP_TARGET_ARCH=intel64
PATH=/opt/intel/oneapi/vtune/2021.7.1/bin64:/opt/intel/oneapi/vpl/2021.6.0/bin:/opt/intel/oneapi/mpi/2021.4.0//libfabric/bin:/opt/intel/oneapi/mpi/2021.4.0//bin:/opt/intel/oneapi/mkl/2021.4.0/bin/intel64:/opt/intel/oneapi/itac/2021.4.0/bin:/opt/intel/oneapi/intelpython/latest/bin:/opt/intel/oneapi/intelpython/latest/condabin:/opt/intel/oneapi/inspector/2021.4.0/bin64:/opt/intel/oneapi/dpcpp-ct/2021.4.0/bin:/opt/intel/oneapi/dev-utilities/2021.4.0/bin:/opt/intel/oneapi/debugger/10.2.4/gdb/intel64/bin:/opt/intel/oneapi/compiler/2021.4.0/linux/lib/oclfpga/llvm/aocl-bin:/opt/intel/oneapi/compiler/2021.4.0/linux/lib/oclfpga/bin:/opt/intel/oneapi/compiler/2021.4.0/linux/bin/intel64:/opt/intel/oneapi/compiler/2021.4.0/linux/bin:/opt/intel/oneapi/clck/2021.4.0/bin/intel64:/opt/intel/oneapi/advisor/2021.4.0/bin64:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
TBBROOT=/opt/intel/oneapi/tbb/2021.4.0/env/..
CONDA_PREFIX=/opt/intel/oneapi/intelpython/latest
DPCT_BUNDLE_ROOT=/opt/intel/oneapi/dpcpp-ct/2021.4.0
DNNLROOT=/opt/intel/oneapi/dnnl/2021.4.0/cpu_dpcpp_gpu_dpcpp
LANG=en_US.UTF-8
VT_LIB_DIR=/opt/intel/oneapi/itac/2021.4.0/lib
INSPECTOR_2021_DIR=/opt/intel/oneapi/inspector/2021.4.0
VT_ROOT=/opt/intel/oneapi/itac/2021.4.0
IPP_TARGET_ARCH=intel64
DAALROOT=/opt/intel/oneapi/dal/2021.4.0
INTEL_PYTHONHOME=/opt/intel/oneapi/debugger/10.2.4/dep
CCL_ROOT=/opt/intel/oneapi/ccl/2021.4.0
VT_SLIB_DIR=/opt/intel/oneapi/itac/2021.4.0/slib
FPGA_VARS_ARGS=
VTUNE_PROFILER_2021_DIR=/opt/intel/oneapi/vtune/2021.7.1
CONDA_PYTHON_EXE=/opt/intel/oneapi/intelpython/latest/bin/python
PYTHONPATH=/opt/intel/oneapi/advisor/2021.4.0/pythonapi
ACL_BOARD_VENDOR_PATH=/opt/Intel/OpenCLFPGA/oneAPI/Boards
APM=/opt/intel/oneapi/advisor/2021.4.0/perfmodels
CLASSPATH=/opt/intel/oneapi/mpi/2021.4.0//lib/mpi.jar:/opt/intel/oneapi/dal/2021.4.0/lib/onedal.jar
CONDA_DEFAULT_ENV=intelpython-python3.7
PKG_CONFIG_PATH=/opt/intel/oneapi/vtune/2021.7.1/include/pkgconfig/lib64:/opt/intel/oneapi/vpl/2021.6.0/lib/pkgconfig:/opt/intel/oneapi/tbb/2021.4.0/env/../lib/pkgconfig:/opt/intel/oneapi/mpi/2021.4.0/lib/pkgconfig:/opt/intel/oneapi/mkl/2021.4.0/lib/pkgconfig:/opt/intel/oneapi/ippcp/2021.4.0/lib/pkgconfig:/opt/intel/oneapi/inspector/2021.4.0/include/pkgconfig/lib64:/opt/intel/oneapi/dpl/2021.5.0/lib/pkgconfig:/opt/intel/oneapi/dal/2021.4.0/lib/pkgconfig:/opt/intel/oneapi/compiler/2021.4.0/lib/pkgconfig:/opt/intel/oneapi/ccl/2021.4.0/lib/pkgconfig:/opt/intel/oneapi/advisor/2021.4.0/include/pkgconfig/lib64:
GDB_INFO=/opt/intel/oneapi/debugger/10.2.4/documentation/info/
ADVISOR_2021_DIR=/opt/intel/oneapi/advisor/2021.4.0
ONEAPI_ROOT=/opt/intel/oneapi
I_MPI_ROOT=/opt/intel/oneapi/mpi/2021.4.0

%runscript
exec /bin/bash "$@"


