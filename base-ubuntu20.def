Bootstrap: docker
From: ubuntu:20.04

%help
This is a base Ubuntu 20.04 setup
GCC 10.3.0
Intel OneAPI
- BaseKit 2021.4.0.3422
- HPCKit 2021.4.0.3347
- AIKit 2021.4.0.1460

%labels
Author Charles Peterson <charles.c.peterson3@gmail.com>

%post
export DEBIAN_FRONTEND=noninteractive
export APT_KEY_DONT_WARN_ON_DANGEROUS_USAGE=1
export SINGULARITY_SHELL=/bin/bash
export SHELL=/bin/bash
apt-get update -y \
&& apt-get install -y libssl-dev libgmp-dev libmpfr-dev libmpc-dev  pkg-config gcc g++ make wget

## Install Cmake 3.22.0
cd /tmp
wget https://github.com/Kitware/CMake/releases/download/v3.22.0-rc1/cmake-3.22.0-rc1.tar.gz
tar -vxf cmake-3.22.0-rc1.tar.gz
cd cmake-3.22.0-rc1
./bootstrap
make ; make install
cd /tmp
rm -rf cmake-3.22.0-rc1*

#Install GCC 10.3.0
wget https://ftp.gnu.org/gnu/gcc/gcc-10.3.0/gcc-10.3.0.tar.gz
tar -vxf gcc-10.3.0.tar.gz
cd gcc-10.3.0
./configure --enable-bootstrap --enable-shared --enable-threads=posix  --enable-languages=c,c++,fortran --disable-multilib
make ; make install
cd /tmp
rm -rf gcc-10.3.0.tar.gz
rm -rf gcc-10.3.0

# Install Intel OneAPI
wget https://registrationcenter-download.intel.com/akdlm/irc_nas/18236/l_BaseKit_p_2021.4.0.3422.sh
bash l_BaseKit_p_2021.4.0.3422.sh -a --silent --eula accept
rm l_BaseKit_p_2021.4.0.3422.sh
wget https://registrationcenter-download.intel.com/akdlm/irc_nas/18211/l_HPCKit_p_2021.4.0.3347.sh
bash l_HPCKit_p_2021.4.0.3347.sh -a --silent --eula accept
rm l_HPCKit_p_2021.4.0.3347.sh
wget https://registrationcenter-download.intel.com/akdlm/irc_nas/18235/l_AIKit_p_2021.4.0.1460.sh
bash l_AIKit_p_2021.4.0.1460.sh -a --silent --eula accept
rm l_AIKit_p_2021.4.0.1460.sh

apt-get remove -y pkg-config gcc g++ make wget

%environment
source /opt/intel/oneapi/setvars.sh

%runscript
exec /bin/bash "$@"


